{
	"version": "2.0.0",
	"tasks": [
		{
			"label": "conan: install (Debug)",
			"type": "shell",
			"command": "conan install . -of builddir -s build_type=Debug -b missing",
			"problemMatcher": [],
			"group": "none",
			"presentation": {
				"reveal": "always",
				"panel": "shared"
			}
		},
		{
			"label": "conan: install (Release)",
			"type": "shell",
			"command": "conan install . -of build/release -s build_type=Release -b missing",
			"problemMatcher": [],
			"group": "none",
			"presentation": {
				"reveal": "always",
				"panel": "shared"
			}
		},
		{
			"label": "meson: setup (Debug)",
			"type": "shell",
			"dependsOn": [
				"conan: install (Debug)"
			],
			"command": "meson setup builddir --native-file builddir/build-debug/conan/conan_meson_native.ini -Dbuildtype=debug",
			"problemMatcher": [
				"$gcc"
			],
			"group": "none",
			"presentation": {
				"reveal": "always",
				"panel": "shared"
			}
		},
		{
			"label": "meson: setup (Release)",
			"type": "shell",
			"dependsOn": [
				"conan: install (Release)"
			],
			"command": "meson setup build/release --native-file build/release/build-release/conan/conan_meson_native.ini -Dbuildtype=release",
			"problemMatcher": [
				"$gcc"
			],
			"group": "none",
			"presentation": {
				"reveal": "always",
				"panel": "shared"
			}
		},
		{
			"label": "meson: configure (Debug)",
			"type": "shell",
			"dependsOn": [
				"meson: setup (Debug)"
			],
			"command": "meson configure builddir",
			"problemMatcher": [],
			"group": "none"
		},
		{
			"label": "meson: compile (Debug)",
			"type": "shell",
			"dependsOn": [
				"meson: setup (Debug)"
			],
			"command": "meson compile -C builddir",
			"problemMatcher": [
				"$gcc"
			],
			"group": {
				"kind": "build",
				"isDefault": true
			},
			"presentation": {
				"reveal": "always",
				"panel": "shared"
			}
		},
		{
			"label": "meson: compile (Release)",
			"type": "shell",
			"dependsOn": [
				"meson: setup (Release)"
			],
			"command": "meson compile -C build/release",
			"problemMatcher": [
				"$gcc"
			],
			"group": "build",
			"presentation": {
				"reveal": "always",
				"panel": "shared"
			}
		},
		{
			"label": "meson: test (Debug)",
			"type": "shell",
			"dependsOn": [
				"meson: compile (Debug)"
			],
			"command": "meson test -C builddir --print-errorlogs",
			"problemMatcher": [
				"$gcc"
			],
			"group": {
				"kind": "test",
				"isDefault": true
			},
			"presentation": {
				"reveal": "always",
				"panel": "shared"
			}
		},
		{
			"label": "meson: clean",
			"type": "shell",
			"command": "rm -rf builddir build/release",
			"problemMatcher": [],
			"group": "none"
		},
		{
			"label": "local-ci: build image (ubuntu-24.04)",
			"type": "shell",
			"command": "docker build -t yams/local-ci:ubuntu-24.04 -f docker/local-ci/ubuntu.Dockerfile .",
			"problemMatcher": [],
			"group": {
				"kind": "build",
				"isDefault": false
			}
		},
		{
			"label": "local-ci: run meson unit tests (docker)",
			"type": "shell",
			"dependsOn": [
				"local-ci: build image (ubuntu-24.04)"
			],
			"command": "docker run --rm -v ${workspaceFolder}:/work -w /work yams/local-ci:ubuntu-24.04 bash -lc 'scripts/local-ci/run_meson_tests.sh'",
			"problemMatcher": [
				"$gcc"
			],
			"group": "test"
		},
		{
			"label": "local-ci: run daemon-only tests (docker)",
			"type": "shell",
			"dependsOn": [
				"local-ci: build image (ubuntu-24.04)"
			],
			"command": "docker run --rm -v ${workspaceFolder}:/work -w /work yams/local-ci:ubuntu-24.04 bash -lc 'XDG_RUNTIME_DIR=/run/user/$(id -u) mkdir -p \"$XDG_RUNTIME_DIR\" && BUILD_DIR=build/yams-debug conan install . -of \"$BUILD_DIR\" -s build_type=Debug -o \"yams/*:build_tests=True\" --build=missing && meson setup \"$BUILD_DIR\" -Dbuildtype=debug -Dbuild-tests=true -Denable-onnx=disabled && meson compile -C \"$BUILD_DIR\" && meson test -C \"$BUILD_DIR\" --print-errorlogs --no-rebuild --suite unit+isolated --test-args=\"--gtest_filter=DaemonTest.*\"'",
			"problemMatcher": [
				"$gcc"
			],
			"group": "test"
		},
		{
			"label": "local-ci: clean build cache (docker)",
			"type": "shell",
			"command": "docker run --rm -v ${workspaceFolder}:/work -w /work yams/local-ci:ubuntu-24.04 bash -lc 'rm -rf build || true'",
			"problemMatcher": [],
			"group": "none"
		},
		{
			"label": "local-ci: run meson unit tests (docker)",
			"type": "shell",
			"command": "docker run --rm -v ${workspaceFolder}:/work -w /work yams/local-ci:ubuntu-24.04 bash -lc 'scripts/local-ci/run_meson_tests.sh'",
			"isBackground": false,
			"problemMatcher": [
				"$gcc"
			],
			"group": "test"
		}
	]
}