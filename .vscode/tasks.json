{
	"version": "2.0.0",
	"tasks": [
		{
			"label": "setup (Debug)",
			"type": "shell",
			"windows": {
				"command": ".\\setup.ps1 Debug"
			},
			"linux": {
				"command": "./setup.sh Debug"
			},
			"osx": {
				"command": "./setup.sh Debug"
			},
			"problemMatcher": [],
			"presentation": {
				"reveal": "always",
				"panel": "shared"
			},
			"group": {
				"kind": "build",
				"isDefault": true
			}
		},
		{
			"label": "setup (Release)",
			"type": "shell",
			"windows": {
				"command": ".\\setup.ps1 Release"
			},
			"linux": {
				"command": "./setup.sh Release"
			},
			"osx": {
				"command": "./setup.sh Release"
			},
			"problemMatcher": [],
			"presentation": {
				"reveal": "always",
				"panel": "shared"
			}
		},
		{
			"label": "build (Debug)",
			"type": "shell",
			"windows": {
				"command": "builddir\\build-debug\\conan\\conanbuild.ps1; meson compile -C builddir"
			},
			"linux": {
				"command": "meson compile -C builddir"
			},
			"osx": {
				"command": "meson compile -C builddir"
			},
			"problemMatcher": [
				"$msCompile"
			],
			"group": {
				"kind": "build",
				"isDefault": true
			},
			"presentation": {
				"reveal": "always",
				"panel": "shared"
			}
		},
		{
			"label": "meson-build-debug",
			"type": "shell",
			"windows": {
				"command": "if (Test-Path builddir\\build-debug\\conan\\conanbuild.ps1) { builddir\\build-debug\\conan\\conanbuild.ps1 }; meson compile -C builddir"
			},
			"linux": {
				"command": "meson compile -C builddir"
			},
			"osx": {
				"command": "meson compile -C builddir"
			},
			"problemMatcher": [
				"$msCompile"
			],
			"group": "build",
			"presentation": {
				"reveal": "always",
				"panel": "shared"
			}
		},
		{
			"label": "build (Release)",
			"type": "shell",
			"windows": {
				"command": "build\\release\\build-release\\conan\\conanbuild.ps1; meson compile -C build/release"
			},
			"linux": {
				"command": "meson compile -C build/release"
			},
			"osx": {
				"command": "meson compile -C build/release"
			},
			"problemMatcher": [
				"$msCompile"
			],
			"group": "build",
			"presentation": {
				"reveal": "always",
				"panel": "shared"
			}
		},
		{
			"label": "meson-build-release",
			"type": "shell",
			"windows": {
				"command": "if (Test-Path build\\release\\build-release\\conan\\conanbuild.ps1) { build\\release\\build-release\\conan\\conanbuild.ps1 }; meson compile -C build/release"
			},
			"linux": {
				"command": "meson compile -C build/release"
			},
			"osx": {
				"command": "meson compile -C build/release"
			},
			"problemMatcher": [
				"$msCompile"
			],
			"group": "build",
			"presentation": {
				"reveal": "always",
				"panel": "shared"
			}
		},
		{
			"label": "test (Debug)",
			"type": "shell",
			"dependsOn": [
				"build (Debug)"
			],
			"command": "meson test -C builddir --print-errorlogs",
			"problemMatcher": [
				"$gcc"
			],
			"group": {
				"kind": "test",
				"isDefault": true
			},
			"presentation": {
				"reveal": "always",
				"panel": "shared"
			}
		},
		{
			"label": "clean",
			"type": "shell",
			"windows": {
				"command": "Remove-Item -Recurse -Force builddir,build -ErrorAction SilentlyContinue"
			},
			"linux": {
				"command": "rm -rf builddir build"
			},
			"osx": {
				"command": "rm -rf builddir build"
			},
			"problemMatcher": [],
			"group": "none"
		},
		{
			"label": "local-ci: build image (ubuntu-24.04)",
			"type": "shell",
			"command": "docker build -t yams/local-ci:ubuntu-24.04 -f docker/local-ci/ubuntu.Dockerfile .",
			"problemMatcher": [],
			"group": {
				"kind": "build",
				"isDefault": false
			}
		},
		{
			"label": "local-ci: run meson unit tests (docker)",
			"type": "shell",
			"dependsOn": [
				"local-ci: build image (ubuntu-24.04)"
			],
			"command": "docker run --rm -v ${workspaceFolder}:/work -w /work yams/local-ci:ubuntu-24.04 bash -lc 'scripts/local-ci/run_meson_tests.sh'",
			"problemMatcher": [
				"$gcc"
			],
			"group": "test"
		},
		{
			"label": "local-ci: run daemon-only tests (docker)",
			"type": "shell",
			"dependsOn": [
				"local-ci: build image (ubuntu-24.04)"
			],
			"command": "docker run --rm -v ${workspaceFolder}:/work -w /work yams/local-ci:ubuntu-24.04 bash -lc 'XDG_RUNTIME_DIR=/run/user/$(id -u) mkdir -p \"$XDG_RUNTIME_DIR\" && BUILD_DIR=build/yams-debug conan install . -of \"$BUILD_DIR\" -s build_type=Debug -o \"yams/*:build_tests=True\" --build=missing && meson setup \"$BUILD_DIR\" -Dbuildtype=debug -Dbuild-tests=true -Denable-onnx=disabled && meson compile -C \"$BUILD_DIR\" && meson test -C \"$BUILD_DIR\" --print-errorlogs --no-rebuild --suite unit+isolated --test-args=\"--gtest_filter=DaemonTest.*\"'",
			"problemMatcher": [
				"$gcc"
			],
			"group": "test"
		},
		{
			"label": "local-ci: clean build cache (docker)",
			"type": "shell",
			"command": "docker run --rm -v ${workspaceFolder}:/work -w /work yams/local-ci:ubuntu-24.04 bash -lc 'rm -rf build || true'",
			"problemMatcher": [],
			"group": "none"
		}
	]
}
